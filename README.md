# Linux下自制汉字形声码输入法

## 汉字拆分

所有GB2312的6763个汉字都在 breakdown.txt 文件中拆分。
文件的开头是独体字的拆分，最直接的学习方法就是看它们是
怎么被拆的。

## 编码规则

所有字根及其编码都在 group.txt 文件中，下面是简单的归类,
并不包括所有字根。

| 字母 | 代表字根 | 特征 |
|------|----------|------|
| A | 女 又 夂 | 不规则封闭 |
| B | 日 | 方形内有两个区域 |
| C | 虫 | 虫及其变体 |
|   | 匚凵 | 左包围、下包围 |
|   | 儿 几 尢 | 儿形、向右弯勾 |
| D | 丶 丿 | 单笔点、单笔撇 |
| E | 山 巾 彐 | 旋转或镜像后像E |
|   | 止 正 五 | 不规则横竖组合 |
| F | 扌 丰 中 | 竖笔穿过多个横笔 |
| G | ⺈ 刀 弓 | 向左弯勾 |
| H | 一 | 单笔横 |
|   | 艹 廾 井 | 横笔穿过多个竖、撇笔 |
| I | 讠 辶 亠 | 点下带横或折 |
| J | 广 厂 | 左上包围 |
|   | 刂 小 水 | 竖勾组合 |
| K | 衤 彳 丬 | 横或竖带两点 |
| L | 钅       | 竖提、竖折 |
|   | 匕 乙 电 | 向右弯勾 |
| M | 木 | 木字架 |
| N | [捺] | 单笔捺 |
|   | 宀 冖 戊 | 宝盖头，戊盖头 |
|   | 目 且 | 方形内有两横 |
| O | 口 凹 凸 | 封闭中空 |
| P | 阝 耳 尸 | 封闭形悬挂于竖、撇笔 |
| Q | 囗 | 国字框 |
|   | 田 由 覀 | 方形内有至少三个区域 |
|   | [司头] | 右上包围 |
| R | 火 大 丈 | 两脚支撑 |
| S | 丨 | 单笔竖 |
|   | 礻 卜 | 竖带点 |
|   | 人 犭 [戋] | 斜连接、斜多交叉 |
| T | 亻 丁 干 | 上阻挡 |
| U | 月 冂 勹 | 大盖头带竖勾 |
| V | 纟 幺 厶 | 绞丝尖形 |
|   | 心 爫 | 一笔带三点 |
| W | 氵 灬 三 | 离散三、四笔 |
| X | 忄 十 乂 | 两笔交叉 |
| Y | 土 [青头] | 下阻挡 |
| Z | 廴 九 力 | 折交叉 |
|   | 王 工 | 上下阻挡 |
|   | 了 [飞] | 横折笔 |
| ; | 疒 冫 二 | 离散两笔 |

该编码对表形码有多处借鉴，但总体上还是有很大不同的。
采用27键编码，实在没有理由放着原位键上的分号不用，
写中文有几时用得到分号呢？

编码基本是前三后一，不足四码时加拼音的声母。最关键的
是：当取形超过四码时，单笔划的横、竖、撇、点将被忽略，
除非该笔划是第一码。

所有简码根据汉字使用频率自动生成，不会有重码。

## 码表生成

生成编码的命令行是：

    ./gene.py -p

-p 指定不足四码时加拼音的声母，要不然就是纯形码啦。
运行结束时显示27组字根，120多的重码。产生的编码文件
是 code.txt。

## 安装

先安装小企鹅输入法：

    sudo apt-get install fcitx-table

拷贝配置文件：

    mkdir -p ~/.config/fcitx/table
    cp ./shape.conf ~/.config/fcitx/table

然后运行：

    ./install.sh

以后每次修改或新生成编码文件后，同样运行 ./install.sh
使改动生效。

## 后记

十几年前还是学生的时候，我对输入法的制作产生了浓厚的
兴趣。那时的拼音还不够智能，还比不上拼形编码。印象
最深的是表形码，它把汉字字根和英文字母以象形的方式
联系起来。这种联系是如此地深刻，以至于从未实际使用过
表形码的我在十几年后还记得口是O，女是A，门是N，
纟是W …… 等等。

当时是个万码腾的年代，我只会拼音，也打不快，但我会写
程序。于是萌生了一个想法，可不可以用程序自动生成一个
编码方案，并加以优化呢？热血一涌上头，我就开始了自己
的拆字工程。GB2312有6763个汉字，前后花了几个星期，
终于把容易的复合字拆完了。复合字都有明显的左右结构、
上下结构或包围结构，所以容易。剩下的独体字就难了，
不同的形码有不同的拆法。于是又花了几个星期，按照比较
熟悉的表形码规则拆完了它们。

拆字可以说是形码设计过程中最耗时、最耗体力的部份了，
因为汉字实在是太多了。我只拆了六千多字就累得半死，
更不必说拆几万字的大字库了。如果不同的设计者们能够
共享这个过程，他们就可以有更多的精力去优化编码方案。
这些都是后话。

字是拆完了，也产生了两百多个字根。当时简单地把它们
按起始笔划归类，分配到26个英文字母键上，然后写了个
Python程序把6763个汉字编码，最长四码。结果统计了一下，
竟然有将近1300个重码。于是我又写了一个优化程序，自由
地把字根分配到字母键上。即使这样完全不实用的编码，
也有将近500个重码。真是不动手就不知道难啊！

之后因为学业，就没有继续在编码上花时间了。这一放，
就放了十几年。当有一天整理以前写过的程序时，不经意
发现了这一段尘封的往事，又提起了我对输入法的兴趣。
时过境迁，拼音已不是当年的拼音，其智能输入方式早已把
大量形码远远地甩在了身后，摇身一变成为主流。搞形码的
越来越少，我又有什么理由再把以前未完成的形码捡起来呢？

有！就因为我能。这已经是一个个性化的时代了，人们做事
不再是为了生计或是图个名利。想做就做，更多的是为了
与众不同。
